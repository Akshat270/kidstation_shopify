{% assign ns = 'faqimg-' | append: section.id %}

<section class="{{ ns }}-section" data-section-id="{{ section.id }}">
  <div class="{{ ns }}-container">
    <div class="{{ ns }}-grid">
      <!-- Left: FAQ -->
      <div class="{{ ns }}-faqs">
        {% if section.settings.heading != blank %}
          <h2 class="{{ ns }}-heading">
            {{ section.settings.heading | escape }}
            {% if section.settings.accent != blank %}
              <span class="{{ ns }}-accent">{{ section.settings.accent }}</span>
            {% endif %}
          </h2>
        {% endif %}

        <div class="{{ ns }}-list" role="list">
          {% for block in section.blocks %}
            {% if block.type == 'qa' %}
              <details class="{{ ns }}-item" {% if forloop.first %}open{% endif %} {{ block.shopify_attributes }}>
                <summary class="{{ ns }}-q">
                  <span>{{ block.settings.q | escape }}</span>
                  <svg class="{{ ns }}-chev" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </summary>
                {% if block.settings.a != blank %}
                  <div class="{{ ns }}-a rte">{{ block.settings.a }}</div>
                {% endif %}
              </details>
              {% unless forloop.last %}
                <div class="{{ ns }}-rule" aria-hidden="true"></div>
              {% endunless %}
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Right: Image -->
      <div class="{{ ns }}-media">
        {% if section.settings.image %}
          <img
            class="{{ ns }}-img"
            src="{{ section.settings.image | image_url: width: 1600 }}"
            alt="{{ section.settings.alt | escape }}"
            loading="lazy">
        {% else %}
          <div class="{{ ns }}-ph">Add an image</div>
        {% endif %}
      </div>
    </div>
  </div>

  <style>
    .{{ ns }}-section{padding:36px 0;background:{{ section.settings.bg | default: '#f7fbff' }}}
    .{{ ns }}-container{max-width:1300px;margin:0 auto;padding:0}
    .{{ ns }}-grid{
      display:grid;grid-template-columns:1.25fr 1fr;gap:40px;align-items:start
    }
    @media screen and (min-width: 990px) and (max-width: 1320px){
      .{{ ns }}-container{
        padding-left: 20px !important;
        padding-right: 20px !important;
      }
    }
    @media (max-width: 990px){
      .{{ ns }}-grid{grid-template-columns:1fr;gap:24px}
      .{{ ns }}-container{padding:0 20px}
      /* Kill the mobile tap highlight on the FAQ question row */
      .{{ ns }}-q {
        -webkit-tap-highlight-color: transparent; /* iOS/Android */
        background: transparent;                  /* guard against UA bg */
      }

      /* Don’t show the default focus ring (we’ll replace it with a nicer one) */
      .{{ ns }}-q:focus { outline: none; }

      /* Accessible focus style for keyboard users */
      .{{ ns }}-q:focus-visible {
        outline: 2px solid #0f4264;
        outline-offset: 4px;
        border-radius: 8px;
      }

      /* Prevent pressed-state background flash on some Android builds */
      .{{ ns }}-q:active { background: transparent; }

    }

    /* Heading */
    .{{ ns }}-heading{
      margin:0 0 18px;font-weight:600;line-height:1.15;
      font-size:clamp(22px,3.2vw,30px);color:#000
    }

    .{{ ns }}-accent{color:#0f4264;margin-left:.25em}

    /* FAQ list */
    .{{ ns }}-list{background:transparent;border-radius:12px}
    .{{ ns }}-item{padding:0}
    .{{ ns }}-q{
      list-style:none;display:flex;justify-content:space-between;align-items:center;
      gap:16px;cursor:pointer;padding:18px 0;font-size:clamp(16px,2.1vw,20px);font-weight:600;color:#0f4264
    }
    .{{ ns }}-item[open] .{{ ns }}-q{color:#0f4264}
    .{{ ns }}-q::-webkit-details-marker{display:none}
    .{{ ns }}-chev{flex:0 0 auto;color:#1f6a94;transition:transform .2s ease}
    .{{ ns }}-item[open] .{{ ns }}-chev{transform:rotate(180deg)}

    .{{ ns }}-a{
      padding:0 0 16px 0;color:#000;font-size:clamp(14px,1.6vw,16px);line-height:1.6
    }
    .{{ ns }}-rule{height:2px !important;background:#e6eef5; display: block !important;}

    /* Image */
    .{{ ns }}-media{border-radius:14px;overflow:hidden;background:#eef4fa}
    .{{ ns }}-img{display:block;width:100%;height:auto;border-radius:14px}
    .{{ ns }}-ph{display:grid;place-items:center;aspect-ratio:4/3;color:#7a8a9a}

    /* RTE basics in answer */
    .{{ ns }}-a.rte p{margin:0 0 10px}
    .{{ ns }}-a.rte ul{margin:10px 0 10px 18px}
  </style>

  <script>
  (function(){
    var root = document.querySelector('.{{ ns }}-section');
    if(!root) return;

    // Exclusive accordion: keep only one <details> open at a time
    root.addEventListener('toggle', function(e){
      var item = e.target.closest('details.{{ ns }}-item');
      if(!item || !item.open) return;
      root.querySelectorAll('details.{{ ns }}-item').forEach(function(d){
        if(d !== item) d.removeAttribute('open');
      });
    }, true);
  })();
  </script>
</section>

{% schema %}
{
  "name": "FAQ with Image",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Frequently" },
    { "type": "text", "id": "accent", "label": "Accent word (colored)", "default": "Asked Questions" },
    { "type": "image_picker", "id": "image", "label": "Right image" },
    { "type": "text", "id": "alt", "label": "Image alt text" },
    { "type": "color", "id": "bg", "label": "Section background", "default": "#F4FBFF" }
  ],
  "blocks": [
    {
      "type": "qa",
      "name": "FAQ item",
      "settings": [
        { "type": "text", "id": "q", "label": "Question", "default": "Sample question?" },
        { "type": "richtext", "id": "a", "label": "Answer", "default": "<p>Type your answer here.</p>" }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "FAQ with Image",
      "blocks": [
        { "type": "qa" },
        { "type": "qa" },
        { "type": "qa" },
        { "type": "qa" }
      ]
    }
  ]
}
{% endschema %}
